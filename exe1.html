<html>
    <head>
        <title>exe1</title>
    </head>
    <body>
        <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

        <a-scene shadow="type: pcfsoft">
            <a-light type="directional"
                position="5 5 5"
                intensity="1"
                light="castShadow: true"
                shadow-camera-left="-15"
                shadow-camera-right="15"
                shadow-camera-top="15"
                shadow-camera-bottom="-15"
                shadow-map-width="2048"
                shadow-map-height="2048"
                shadow-bias="-0.0001">
            </a-light>
            <a-box position="-5 2 -3" rotation="0 45 0" color="#4CC3D9"
                   shadow="cast: true; receive: true"></a-box>
            <a-sphere position="0 2 -5" radius="1.25" color="#EF2D5E"
                      shadow="cast: true; receive: true"></a-sphere>
            <a-cylinder position="4 2 7" radius="0.5" height="1.5" color="#FFC65D"
                        shadow="cast: true; receive: true"></a-cylinder>
            <a-plane rotation="-90 0 0" width="20" height="20" color="#7BC8A4"
                     shadow="receive: true"></a-plane>
            <a-entity id="playerRig" position="0 1 0">
                <a-entity id="cameraRig" position="0 1.6 0">
                <a-camera wasd-controls look-controls id="camera"></a-camera>
                </a-entity>
                <a-entity oculus-touch-controls="hand: left"></a-entity>
                <a-entity oculus-touch-controls="hand: right"></a-entity>
            </a-entity>
        </a-scene>
    </body>
    <script>
        const rig = document.getElementById('playerRig');
        const camera = document.getElementById('camera');

        document.querySelectorAll('[oculus-touch-controls]').forEach(controller => {
            controller.addEventListener('thumbstickmoved', evt => {
                const hand = controller.getAttribute('oculus-touch-controls').hand;
                const x = evt.detail.x;
                const y = evt.detail.y;

                const speed = 0.05;
                const rotSpeed = 2;

                // Get camera forward direction
                const camObj = camera.object3D;
                const forward = new THREE.Vector3();
                camObj.getWorldDirection(forward);
                forward.y = 0; // mouvement sur le sol
                forward.normalize();

                const right = new THREE.Vector3();
                right.crossVectors(new THREE.Vector3(0,1,0), forward).normalize();

                const pos = rig.getAttribute('position');

                if(hand === 'left'){
                // d√©placement
                rig.setAttribute('position', {
                    x: pos.x + forward.x * -y * speed + right.x * x * speed,
                    y: pos.y,
                    z: pos.z + forward.z * -y * speed + right.z * x * speed
                });
                }

                if(hand === 'right'){
                // rotation du rig sur Y
                const rot = rig.getAttribute('rotation');
                rig.setAttribute('rotation', {
                    x: rot.x,
                    y: rot.y - x * rotSpeed,
                    z: rot.z
                });
                }
            });
        });
    </script>

</html> 