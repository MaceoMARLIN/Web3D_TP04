<html>
    <head>
        <title>exe1</title>
    </head>
    <body>
        <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

        <a-scene shadow="type: pcfsoft">
            <a-light type="directional"
                position="5 5 5"
                intensity="1"
                light="castShadow: true"
                shadow-camera-left="-15"
                shadow-camera-right="15"
                shadow-camera-top="15"
                shadow-camera-bottom="-15"
                shadow-map-width="2048"
                shadow-map-height="2048"
                shadow-bias="-0.0001">
            </a-light>
            <a-box position="-5 2 -3" rotation="0 45 0" color="#4CC3D9"
                   shadow="cast: true; receive: true"></a-box>
            <a-sphere position="0 2 -5" radius="1.25" color="#EF2D5E"
                      shadow="cast: true; receive: true"></a-sphere>
            <a-cylinder position="4 2 7" radius="0.5" height="1.5" color="#FFC65D"
                        shadow="cast: true; receive: true"></a-cylinder>
            <a-plane rotation="-90 0 0" width="20" height="20" color="#7BC8A4"
                     shadow="receive: true"></a-plane>
            <a-entity id="rig" position="0 1.6 0">
                <a-camera wasd-controls look-controls></a-camera>
            </a-entity>
            <a-entity oculus-touch-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc""></a-entity>
            <a-entity oculus-touch-controls="hand: right;  handModelStyle: lowPoly; color: #ffcccc"></a-entity>
        </a-scene>
    </body>
    <script>
        const rig = document.getElementById('rig');

        window.addEventListener('axismove', function (evt) {
        // evt.detail.axis = [x, y] pour chaque joystick
            const gamepad = evt.detail.axis; // tableau flottant [-1, 1]
            const hand = evt.detail.hand;    // "left" ou "right"

            const speed = 0.05; // vitesse de déplacement
            const rotSpeed = 1.5; // vitesse de rotation

            if (hand === 'left') {
                // joystick gauche : déplacement (forward/back + strafe)
                const forward = -gamepad[1]; // axe Y
                const strafe = gamepad[0];   // axe X

                // direction globale selon rotation du rig
                const angle = rig.getAttribute('rotation').y * Math.PI / 180;
                const dx = Math.sin(angle) * forward + Math.cos(angle) * strafe;
                const dz = Math.cos(angle) * forward - Math.sin(angle) * strafe;

                const pos = rig.getAttribute('position');
                rig.setAttribute('position', {
                    x: pos.x + dx * speed,
                    y: pos.y,
                    z: pos.z + dz * speed
                });
            }

            if (hand === 'right') {
                // joystick droit : rotation Y du rig
                const yaw = -gamepad[0]; // axe X du joystick droit
                const rot = rig.getAttribute('rotation');
                rig.setAttribute('rotation', {
                    x: rot.x,
                    y: rot.y + yaw * rotSpeed,
                    z: rot.z
                });
            }
        });
    </script>

</html> 